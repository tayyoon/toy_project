<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>MBTI</title>

    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0 auto;
            font-family: 'Gowun Dodum', sans-serif;
        }
        .chart {
            width: 95vw;
            display:  flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;

            border : 1px dotted black;

        }

    </style>

    <script>

    </script>

</head>
<body>

<div class="chart">
    <p> 성향별 분포 </p>
    <div class = "graph1"><canvas id=chart_1></canvas></div>
    <div class = "graph2"><canvas id=chart_2></canvas></div>
    <div class = "graph3"><canvas id=chart_3></canvas></div>
    <div class = "graph4"><canvas id=chart_4></canvas></div>
</div>

<script>
    $(document).ready(function () {
            listing();
        });

    function listing() {
        $.ajax({
            type: 'GET',
            url: '/mbti',
            data: {},
            success: function (response) {
                let rows = response['mbtis']

                let count_e = 0
                let count_i = 0
                let count_n = 0
                let count_s = 0
                let count_f = 0
                let count_t = 0
                let count_p = 0
                let count_j = 0

                for (let i = 0; i < rows.length; i++) {
                    let mbti_1 = rows[i]['mbti'][0]
                    let mbti_2 = rows[i]['mbti'][1]
                    let mbti_3 = rows[i]['mbti'][2]
                    let mbti_4 = rows[i]['mbti'][3]

                    if (mbti_1 == 'e') {
                        count_e += 1
                    } else {
                        count_i += 1
                    }
                    if (mbti_2 == 'n'){
                        count_n += 1;
                    }else {
                        count_s += 1
                    }
                    if (mbti_3 == 'f'){
                        count_f += 1;
                    }else {
                        count_t += 1
                    }
                    if (mbti_4 == 'p'){
                        count_p += 1;
                    }else {
                        count_j += 1
                    }
                }
                let mychart_1 = $('#chart_1')
                let mbti_color_1 = [
                    'rgb(239, 149, 242)',
                    'rgb(68, 212, 240)'
                ]
                    let my_mbti_chart1 = new Chart(mychart_1, {
                        type : 'doughnut',
                        data : {
                            labels : ['E','I'],
                            datasets : [
                                {
                                    label : '판단/인식의 방향',
                                    data : [count_e,count_i],
                                    backgroundColor : mbti_color_1
                                }
                            ],

                        }
                    });

                let mychart_2 = $('#chart_2')
                let mbti_color_2 = [
                    'rgb(96, 171, 246)',
                    'rgb(242, 247, 91)'
                ]
                    let my_mbti_chart2 = new Chart(mychart_2, {
                        type : 'doughnut',
                        data : {
                            labels : ['N','S'],
                            datasets : [
                                {
                                    label : '2022',
                                    data : [count_n,count_s],
                                    backgroundColor : mbti_color_2
                                }
                            ]
                        }
                    });

                let mychart_3 = $('#chart_3')
                let mbti_color_3 = [
                    'rgb(178, 102, 255)',
                    'rgb(255, 255, 102)'
                ]
                    let my_mbti_chart3 = new Chart(mychart_3, {
                        type : 'doughnut',
                        data : {
                            labels : ['F','T'],
                            datasets : [
                                {
                                    label : '2022',
                                    data : [count_f,count_t],
                                    backgroundColor : mbti_color_3
                                }
                            ]
                        }
                    });

                let mychart_4 = $('#chart_4')
                let mbti_color_4 = [
                    'rgb(96, 171, 246)',
                    'rgb(242,247,91)'
                ]
                    let my_mbti_chart4 = new Chart(mychart_4, {
                        type : 'doughnut',
                        data : {
                            labels : ['P','J'],
                            datasets : [
                                {
                                    label : '2022',
                                    data : [count_p,count_j],
                                    backgroundColor : mbti_color_4
                                }
                            ]
                        }
                    });
            }
        })
    }



</script>


</body>
</html>
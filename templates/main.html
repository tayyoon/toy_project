<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>

      <link rel="stylesheet" href="../static/style.css">

    <title>항해99 6기 MBTI</title>

    <style>
      .title {
        text-align: center;
        font-size: 30px;
        font-weight: bold;
        margin-top: 70px;
        position: absolute;
      }

      .chart-container {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
      }

      #myChart {
        margin: 0 auto;
      }

      .mbti-circles {
        display: flex;
      }

      .mbti-circle {
        position: relative;
        margin: 40px;
      }

      .left {
        position: absolute;
        left: 0;
        top: 155px;
      }

      .right {
        position: absolute;
        right: 0;
        top: 155px;
      }
    </style>
    <script>
      let user_mbti = "intj";
      $(document).ready(function () {
        show_stat();
      });

      function show_stat() {
        $.ajax({
          type: "GET",
          url: "/mbti",
          data: {},
          success: function (response) {
            let mbti_arr = [
              { mbti: "istj", count: 0 },
              { mbti: "istp", count: 0 },
              { mbti: "isfj", count: 0 },
              { mbti: "isfp", count: 0 },
              { mbti: "intj", count: 0 },
              { mbti: "intp", count: 0 },
              { mbti: "infj", count: 0 },
              { mbti: "infp", count: 0 },
              { mbti: "estj", count: 0 },
              { mbti: "estp", count: 0 },
              { mbti: "esfj", count: 0 },
              { mbti: "esfp", count: 0 },
              { mbti: "entj", count: 0 },
              { mbti: "entp", count: 0 },
              { mbti: "enfj", count: 0 },
              { mbti: "enfp", count: 0 },
            ];

            let mbti_detail = {
              i: 0,
              e: 0,
              s: 0,
              n: 0,
              t: 0,
              f: 0,
              j: 0,
              p: 0,
            };

            let rows = response["user_list"];
            for (let i = 0; i < rows.length; i++) {
              let mbti = rows[i]["mbti"];
              `1`;
              switch (mbti) {
                case "istj":
                  mbti_arr[0].count += 1;
                  mbti_detail.i += 1;
                  mbti_detail.s += 1;
                  mbti_detail.t += 1;
                  mbti_detail.j += 1;
                  break;
                case "istp":
                  mbti_arr[1].count += 1;
                  mbti_detail.i += 1;
                  mbti_detail.s += 1;
                  mbti_detail.t += 1;
                  mbti_detail.p += 1;
                  break;
                case "isfj":
                  mbti_arr[2].count += 1;
                  mbti_detail.i += 1;
                  mbti_detail.s += 1;
                  mbti_detail.f += 1;
                  mbti_detail.j += 1;
                  break;
                case "isfp":
                  mbti_arr[3].count += 1;
                  mbti_detail.i += 1;
                  mbti_detail.s += 1;
                  mbti_detail.f += 1;
                  mbti_detail.p += 1;
                  break;
                case "intj":
                  mbti_arr[4].count += 1;
                  mbti_detail.i += 1;
                  mbti_detail.n += 1;
                  mbti_detail.t += 1;
                  mbti_detail.j += 1;
                  break;
                case "intp":
                  mbti_arr[5].count += 1;
                  mbti_detail.i += 1;
                  mbti_detail.n += 1;
                  mbti_detail.t += 1;
                  mbti_detail.p += 1;
                  break;
                case "infj":
                  mbti_arr[6].count += 1;
                  mbti_detail.i += 1;
                  mbti_detail.n += 1;
                  mbti_detail.f += 1;
                  mbti_detail.j += 1;
                  break;
                case "infp":
                  mbti_arr[7].count += 1;
                  mbti_detail.i += 1;
                  mbti_detail.n += 1;
                  mbti_detail.f += 1;
                  mbti_detail.p += 1;
                  break;
                case "estj":
                  mbti_arr[8].count += 1;
                  mbti_detail.e += 1;
                  mbti_detail.s += 1;
                  mbti_detail.t += 1;
                  mbti_detail.j += 1;
                  break;
                case "estp":
                  mbti_arr[9].count += 1;
                  mbti_detail.e += 1;
                  mbti_detail.s += 1;
                  mbti_detail.t += 1;
                  mbti_detail.p += 1;
                  break;
                case "esfj":
                  mbti_arr[10].count += 1;
                  mbti_detail.e += 1;
                  mbti_detail.s += 1;
                  mbti_detail.f += 1;
                  mbti_detail.j += 1;
                  break;
                case "esfp":
                  mbti_arr[11].count += 1;
                  mbti_detail.e += 1;
                  mbti_detail.s += 1;
                  mbti_detail.f += 1;
                  mbti_detail.p += 1;
                  break;
                case "entj":
                  mbti_arr[12].count += 1;
                  mbti_detail.e += 1;
                  mbti_detail.n += 1;
                  mbti_detail.t += 1;
                  mbti_detail.j += 1;
                  break;
                case "entp":
                  mbti_arr[13].count += 1;
                  mbti_detail.e += 1;
                  mbti_detail.n += 1;
                  mbti_detail.t += 1;
                  mbti_detail.p += 1;
                  break;
                case "enfj":
                  mbti_arr[14].count += 1;
                  mbti_detail.e += 1;
                  mbti_detail.n += 1;
                  mbti_detail.f += 1;
                  mbti_detail.j += 1;
                  break;
                case "enfp":
                  mbti_arr[15].count += 1;
                  mbti_detail.e += 1;
                  mbti_detail.n += 1;
                  mbti_detail.f += 1;
                  mbti_detail.p += 1;
                  break;
              }
            }

            const ctx = $("#myChart");
            let dataSet = mbti_arr.map((obj) => obj.count);
            new Chart(ctx, {
              type: "bar",
              data: {
                labels: [
                  "ISTJ",
                  "ISTP",
                  "ISFJ",
                  "ISFP",
                  "INTJ",
                  "INTP",
                  "INFJ",
                  "INFP",
                  "ESTJ",
                  "ESTP",
                  "ESFJ",
                  "ESFP",
                  "ENTJ",
                  "ENTP",
                  "ENFJ",
                  "ENFP",
                ],
                datasets: [
                  {
                    label: "명",
                    data: dataSet,
                    backgroundColor: [
                      "rgba(255, 99, 132, 0.2)",
                      "rgba(54, 162, 235, 0.2)",
                      "rgba(255, 206, 86, 0.2)",
                      "rgba(75, 192, 192, 0.2)",
                      "rgba(153, 102, 255, 0.2)",
                      "rgba(207, 255, 64, 0.2)",
                      "rgba(255, 159, 64, 0.2)",
                      "rgba(64, 156, 255, 0.2)",
                      "rgba(255, 99, 132, 0.2)",
                      "rgba(54, 162, 235, 0.2)",
                      "rgba(255, 206, 86, 0.2)",
                      "rgba(75, 192, 192, 0.2)",
                      "rgba(153, 102, 255, 0.2)",
                      "rgba(207, 255, 64, 0.2)",
                      "rgba(255, 159, 64, 0.2)",
                      "rgba(64, 156, 255, 0.2)",
                    ],
                    borderColor: [
                      "rgba(255, 99, 132, 1)",
                      "rgba(54, 162, 235, 1)",
                      "rgba(255, 206, 86, 1)",
                      "rgba(75, 192, 192, 1)",
                      "rgba(153, 102, 255, 1)",
                      "rgba(207, 255, 64, 1)",
                      "rgba(255, 159, 64, 1)",
                      "rgba(64, 156, 255, 1)",
                      "rgba(255, 99, 132, 1)",
                      "rgba(54, 162, 235, 1)",
                      "rgba(255, 206, 86, 1)",
                      "rgba(75, 192, 192, 1)",
                      "rgba(153, 102, 255, 1)",
                      "rgba(207, 255, 64, 1)",
                      "rgba(255, 159, 64, 1)",
                      "rgba(64, 156, 255, 1)",
                    ],
                    borderWidth: 0.1,
                  },
                ],
              },
              options: {
                scales: {
                  y: {
                    beginAtZero: true,
                    ticks: {
                      stepSize: 1,
                    },
                  },
                },
              },
            });

            const ctxMbtiIE = $("#mbtiIE");
            new Chart(ctxMbtiIE, {
              type: "doughnut",
              data: {
                datasets: [
                  {
                    data: [mbti_detail.i, mbti_detail.e],
                    backgroundColor: [
                      "rgba(255, 99, 132, 0.4)",
                      "rgba(54, 162, 235, 0.4)",
                    ],
                  },
                ],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: "top",
                  },
                  title: {
                    display: true,
                    text: "E vs I",
                  },
                },
              },
            });
            let temp_left = `<span class="left" style="${
              user_mbti[0] === "e"
                ? "background-color: rgba(54, 162, 235, 1); color: white; font-weight: bold; padding: 5px; border-radius: 5px"
                : ""
            }">${mbti_detail.e} 명 (${Math.round(
              (mbti_detail.e / (mbti_detail.i + mbti_detail.e)) * 100
            )}%)</span>`;
            let temp_right = `<span class="right" style="${
              user_mbti[0] === "i"
                ? "background-color: rgba(255, 99, 132, 1); color: white; font-weight: bold; padding: 5px; border-radius: 5px"
                : ""
            }">${mbti_detail.i} 명 (${Math.round(
              (mbti_detail.i / (mbti_detail.i + mbti_detail.e)) * 100
            )}%)</span>`;
            $(".mbti-ie").prepend(temp_left);
            $(".mbti-ie").append(temp_right);

            const ctxMbtiSN = $("#mbtiSN");
            new Chart(ctxMbtiSN, {
              type: "doughnut",
              data: {
                datasets: [
                  {
                    data: [mbti_detail.s, mbti_detail.n],
                    backgroundColor: [
                      "rgba(255, 206, 86, 0.4)",
                      "rgba(75, 192, 192, 0.4)",
                    ],
                  },
                ],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: "top",
                  },
                  title: {
                    display: true,
                    text: "N vs S",
                  },
                },
              },
            });
            temp_left = `<span class="left" style="${
              user_mbti[1] === "n"
                ? "background-color: rgba(75, 192, 192, 1); color: white; font-weight: bold; padding: 5px; border-radius: 5px"
                : ""
            }">${mbti_detail.n} 명 (${Math.round(
              (mbti_detail.n / (mbti_detail.s + mbti_detail.n)) * 100
            )}%)</span>`;
            temp_right = `<span class="right" style="${
              user_mbti[1] === "s"
                ? "background-color: rgba(255, 206, 86, 1); color: white; font-weight: bold; padding: 5px; border-radius: 5px"
                : ""
            }">${mbti_detail.s} 명 (${Math.round(
              (mbti_detail.s / (mbti_detail.s + mbti_detail.n)) * 100
            )}%)</span>`;
            $(".mbti-sn").prepend(temp_left);
            $(".mbti-sn").append(temp_right);

            const ctxMbtiTF = $("#mbtiTF");
            new Chart(ctxMbtiTF, {
              type: "doughnut",
              data: {
                datasets: [
                  {
                    data: [mbti_detail.t, mbti_detail.f],
                    backgroundColor: [
                      "rgba(153, 102, 255, 0.4)",
                      "rgba(207, 255, 64, 0.4)",
                    ],
                  },
                ],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: "top",
                  },
                  title: {
                    display: true,
                    text: "F vs T",
                  },
                },
              },
            });
            temp_left = `<span class="left" style="${
              user_mbti[2] === "f"
                ? "background-color: rgba(207, 255, 64, 1); color: white; font-weight: bold; padding: 5px; border-radius: 5px"
                : ""
            }">${mbti_detail.f} 명 (${Math.round(
              (mbti_detail.f / (mbti_detail.t + mbti_detail.f)) * 100
            )}%)</span>`;
            temp_right = `<span class="right" style="${
              user_mbti[2] === "t"
                ? "background-color: rgba(153, 102, 255, 1); color: white; font-weight: bold; padding: 5px; border-radius: 5px"
                : ""
            }">${mbti_detail.t} 명 (${Math.round(
              (mbti_detail.t / (mbti_detail.t + mbti_detail.f)) * 100
            )}%)</span>`;
            $(".mbti-tf").prepend(temp_left);
            $(".mbti-tf").append(temp_right);

            const ctxMbtiJP = $("#mbtiJP");
            new Chart(ctxMbtiJP, {
              type: "doughnut",
              data: {
                datasets: [
                  {
                    data: [mbti_detail.j, mbti_detail.p],
                    backgroundColor: [
                      "rgba(255, 159, 64, 0.4)",
                      "rgba(64, 156, 255, 0.4)",
                    ],
                  },
                ],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: "top",
                  },
                  title: {
                    display: true,
                    text: "P vs J",
                  },
                },
              },
            });
            temp_left = `<span class="left" style="${
              user_mbti[3] === "p"
                ? "background-color: rgba(64, 156, 255, 1); color: white; font-weight: bold; padding: 5px; border-radius: 5px"
                : ""
            }">${mbti_detail.p} 명 (${Math.round(
              (mbti_detail.p / (mbti_detail.j + mbti_detail.p)) * 100
            )}%)</span>`;
            temp_right = `<span class="right" style="${
              user_mbti[3] === "j"
                ? "background-color: rgba(255, 159, 64, 1); color: white; font-weight: bold; padding: 5px; border-radius: 5px"
                : ""
            }">${mbti_detail.j} 명 (${Math.round(
              (mbti_detail.j / (mbti_detail.j + mbti_detail.p)) * 100
            )}%)</span>`;
            $(".mbti-jp").prepend(temp_left);
            $(".mbti-jp").append(temp_right);
          },
        });
      }
    </script>
  </head>
  <body>
    <header>
        <a class="logo">MBTI</a>
        <nav class="mynav">
            <ul class="nav__links">
                <li><a href="index.html">통계</a></li>
                <li><a href="#">연예인</a></li>
                <li><a href="#">추가기능</a></li>
            </ul>
        </nav>
        <span class="target"></span>

        <a class="cta" href="#">
            <button>About 18조</button>
        </a>
    </header>

    <div class="title">항해99 6기 MBTI 통계</div>

    <div class="chart-container">
      <canvas id="myChart" width="1000" height="600"></canvas>

      <div class="mbti-circles">
        <div class="mbti-circle mbti-ie">
          <canvas id="mbtiIE" width="300" height="300"></canvas>
        </div>
        <div class="mbti-circle mbti-sn">
          <canvas id="mbtiSN" width="300" height="300"></canvas>
        </div>
        <div class="mbti-circle mbti-tf">
          <canvas id="mbtiTF" width="300" height="300"></canvas>
        </div>
        <div class="mbti-circle mbti-jp">
          <canvas id="mbtiJP" width="300" height="300"></canvas>
        </div>
      </div>
    </div>

  <script>
        const target = document.querySelector('.target')
        const links = document.querySelectorAll('.mynav a')
        const colors = ['deepskyblue','orange','yellow','gold','green','pink','yellow']

        //링크색상 변경
        // links[0].addEventListener('click', function (){})

        for ( let i = 0; i < links.length; i++ ) {
            links[i].addEventListener('click', (e) => e.preventDefault())
            links[i].addEventListener('mouseenter', mouseenterFunc)
        }

        function mouseenterFunc() {
            if (!this.parentNode.classList.contains('active')) {
                for ( let i=0; i < links.length; i++) {
                    if( links[i].parentNode.classList.contains('active')){
                        links[i].parentNode.classList.remove(('active'))
                    }
                    links[i].style.opacity = '1';
                }//마우스가 올라가지않은 다른메뉴들 마다 할일

                this.parentNode.classList.add('active')
                this.style.opacity = '1'

                const width = this.getBoundingClientRect().width
                const height = this.getBoundingClientRect().height
                const left = this.getBoundingClientRect().left + window.pageXOffset
                const top = this.getBoundingClientRect().top + window.pageYOffset
                const color = colors[Math.floor(Math.random() * links.length)]

                target.style.width = `${width}px`
                target.style.height = `${height}px`
                target.style.left = `${left}px`
                target.style.right = `${top}px`
                target.style.borderColor = color;

            }
        }

        function resizeFunc() {
            const active = document.querySelector('.mynav li.active')

            if(active) {
                const left = active.getBoundingClientRect().left + window.pageXOffset
                const top = active.getBoundingClientRect().top + window.pageYOffset

                target.style.left = `${left}px`
                target.style.right = `${top}px`
            }
        }
        window.addEventListener('resize', resizeFunc)
    </script>


  </body>
</html>